CREATE TABLE IF NOT EXISTS Users (
    Id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    Email VARCHAR(320) NOT NULL,
    GoogleId VARCHAR(255) NOT NULL,
    Picture TEXT NULL,
    Names VARCHAR(255) NULL,
    IsActive BOOLEAN NOT NULL DEFAULT true,
    CreatedAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    LastLoginAt TIMESTAMP NULL
);

CREATE UNIQUE INDEX IF NOT EXISTS IX_Users_Email ON Users(Email);
CREATE UNIQUE INDEX IF NOT EXISTS IX_Users_GoogleId ON Users(GoogleId);

INSERT INTO Users (Email, GoogleId, Names, ConnectedAt)
VALUES (
    'bot@user.ia',
    'google_fake_123456789',
    'T-800',
    CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS ChatRooms (
    Id UUID PRIMARY KEY,
    Name TEXT NOT NULL,
    CreatedAt TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS Messages (
    Id UUID PRIMARY KEY,
    Content TEXT NOT NULL,
    SentAt TIMESTAMP NOT NULL,
    UserId UUID NOT NULL REFERENCES Users(Id),
    ChatRoomId UUID NOT NULL REFERENCES ChatRooms(Id)
);


INSERT INTO ChatRooms (Id, Name, CreatedAt)
VALUES ('11112222-3333-4444-5555-666677778888', 'Sala de Prueba', CURRENT_TIMESTAMP);

INSERT INTO Messages 
    (Id, Content, SentAt, UserId, ChatRoomId)
VALUES
    ('11111111-3333-4444-5555-666677778888', '¡Hola desde REST!', CURRENT_TIMESTAMP, '11112222-3333-4444-5555-666677778888', '11112222-3333-4444-5555-666677778888'),
    ('22222222-3333-4444-5555-666677778888', 'Mensaje de prueba desde la API', CURRENT_TIMESTAMP, '11112222-3333-4444-5555-666677778888', '11112222-3333-4444-5555-666677778888');

SELECT * FROM Users;
SELECT * FROM ChatRooms;
SELECT * FROM Messages;

DROP TABLE IF EXISTS Messages;
DROP TABLE IF EXISTS ChatRooms;
DROP TABLE IF EXISTS Users;
